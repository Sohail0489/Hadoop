
REGISTER '/home/auto/smoham3/scripts/Search.jar';
pos = LOAD '/work/syw_member_repo/Telluride/POS_KillVert_Rank_final' using PigStorage('\u0001') AS(
LyltyCardNbr :chararray,
ShoppedSearsBU12months :chararray,
ShoppedSearsDIV12months :chararray,
ShoppedSearsBUDIVLine12months :chararray,
ShoppedSearsKV12months :chararray,
ShoppedKmartBU12months :chararray,
ShoppedKmartDIV12months :chararray,
ShoppedKmartBUDIVLine12months :chararray,
ShoppedKmartKV12months :chararray,
ShoppedSHCBU12months :chararray,
LastTransactionDate :chararray,
SearsTotalSales : chararray,
SearsTripCount : chararray,
KmartTotalSales : chararray,
KmartTripCount : chararray,
SearsPrimaryStore : chararray,
KmartPrimaryStore : chararray,
SearsPrimaryStoreRank : chararray,
KmartPrimaryStoreRank : chararray,
SearsTop1000Flag : chararray,
KmartTop1000Flag : chararray
);

Pos_aggr = FOREACH pos GENERATE
CONCAT(LyltyCardNbr,'POS') as Key,
'POS' as Source,
LyltyCardNbr,
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
ShoppedSearsBU12months,
ShoppedKmartBU12months,
ShoppedSHCBU12months,
ShoppedSearsKV12months,
ShoppedKmartKV12months,
ShoppedSearsDIV12months,
ShoppedKmartDIV12months,
ShoppedSearsBUDIVLine12months,
ShoppedKmartBUDIVLine12months,
org.sears.analytics.SearchUTC(org.sears.analytics.ValidateDate(LastTransactionDate)),
'',
'N',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
SearsPrimaryStore,
KmartPrimaryStore,
SearsTotalSales,
SearsTripCount,
(CASE WHEN SearsPrimaryStore IS NOT NULL THEN SearsPrimaryStoreRank ELSE '' END) as SearsPrimaryStoreRank,
(CASE WHEN SearsPrimaryStore IS NOT NULL THEN SearsTop1000Flag ELSE '' END) as SearsTop1000Flag,
KmartTotalSales,
KmartTripCount,
(CASE WHEN KmartPrimaryStore IS NOT NULL THEN KmartPrimaryStoreRank ELSE '' END) as KmartPrimaryStoreRank,
(CASE WHEN KmartPrimaryStore IS NOT NULL THEN KmartTop1000Flag ELSE '' END) as KmartTop1000Flag
;

STORE Pos_aggr into '/work/syw_member_repo/cdi/pos_agg_output1' using PigStorage('\t');

